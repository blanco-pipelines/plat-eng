# Linux – Finding Files

Locating files efficiently is a critical skill for system administrators who need to audit systems, troubleshoot issues, or manage file permissions across large directory structures. The `find` command is one of the most powerful tools in a sysadmin's toolkit.

Unlike text search tools like `grep`, the `find` command searches based on file attributes—name patterns, permissions, ownership, size, modification time, and more. This makes it invaluable for security audits, disk space management, and system maintenance tasks.

Mastering `find` allows you to quickly locate configuration files, identify security vulnerabilities like world-writable files or setuid binaries, clean up large files, and automate file management tasks using the `-exec` option to perform actions on the files you discover.

### Estimated Time: 30 Minutes

## Part 1: Basic Find Operations

1. Create a practice directory structure
```
mkdir -p ~/find_lab/{config,logs,scripts,data}
cd ~/find_lab
```

2. Create some test files
```
touch config/app.conf config/database.conf config/settings.ini
touch logs/app.log logs/error.log logs/access.log
touch scripts/backup.sh scripts/deploy.sh scripts/monitor.py
touch data/users.csv data/products.json data/report.txt
```

3. Find all files starting from current directory
```
find .
```

4. Find only files (not directories)
```
find . -type f
```

5. Find only directories
```
find . -type d
```

**File type options:**
- `f` - regular file
- `d` - directory
- `l` - symbolic link
- `s` - socket
- `b` - block device

## Part 2: Finding Files by Name

1. Find files with specific names
```
find . -name "app.conf"
```

2. Find files using wildcards (case-sensitive)
```
find . -name "*.log"
```

3. Find files case-insensitive
```
find . -iname "*.CONF"
find . -iname "APP.*"
```

4. Find files that don't match a pattern
```
find . -type f ! -name "*.log"
```

5. Find files matching multiple patterns
```
find . -type f \( -name "*.sh" -o -name "*.py" \)
```

**Pattern matching notes:**
- `-name` is case-sensitive, `-iname` is case-insensitive
- Use quotes around patterns with wildcards
- `!` negates the condition
- `-o` means "or" between conditions
- Use `\(` and `\)` to group conditions

## Part 3: Searching from Root and Redirecting Errors

When searching from `/` (the root directory), you'll encounter many "Permission denied" errors for directories you can't access. The standard technique is to redirect these errors.

1. Search for a file from root (you'll see many errors)
```
find / -name "hosts"
```

2. Redirect errors to /dev/null to see only results
```
find / -name "hosts" 2>/dev/null
```

3. Find all Python scripts on the system
```
find / -name "*.py" -type f 2>/dev/null | head -n 20
```

4. Find configuration files in /etc
```
find /etc -name "*.conf" 2>/dev/null | head -n 10
```

**Understanding error redirection:**
- `2>` redirects stderr (standard error)
- `/dev/null` is a special file that discards all data written to it
- `2>/dev/null` hides error messages while showing normal output
- This is essential when searching system-wide to avoid clutter

## Part 4: Finding Files by Permissions

Finding files with specific permissions is crucial for security audits. World-writable files (777, 666) and setuid/setgid binaries can be security risks.

1. Create files with different permissions
```
cd ~/find_lab
touch perm_test_{1..5}.txt
chmod 777 perm_test_1.txt
chmod 755 perm_test_2.txt
chmod 644 perm_test_3.txt
chmod 666 perm_test_4.txt
chmod 600 perm_test_5.txt
ls -l perm_test_*
```

2. Find files with exact permission 777
```
find . -type f -perm 777
```

3. Find files with exact permission 666
```
find . -type f -perm 666
```

4. Find files that are readable, writable, and executable by everyone
```
find . -type f -perm -777
```

**Permission search modes:**
- `-perm 644` - Exact match (must be exactly 644)
- `-perm -644` - At least these permissions (has all bits set)
- `-perm /644` - Any of these permissions (has any bit set)

## Part 5: Finding Setuid and Setgid Files

Setuid and setgid files execute with the permissions of their owner or group, not the user running them. These can be security vulnerabilities if not properly managed.

4. Find both setuid and setgid files
```
find /usr -type f \( -perm -4000 -o -perm -2000 \) 2>/dev/null | head -n 10
```

**Special permission bits:**
- `4000` - setuid (runs with owner's privileges)
- `2000` - setgid (runs with group's privileges)
- `1000` - sticky bit (prevents deletion by non-owners)

Common setuid binaries like `passwd`, `sudo`, and `ping` need these permissions to function, but unexpected setuid files should be investigated.

## Part 6: Finding Files by User and Group

1. Create a test file with your current user
```
cd ~/find_lab
touch myfile.txt
echo "test data" > userfile.txt
```

2. Find files owned by your current user
```
find ~/find_lab -type f -user $(whoami)
```

3. Find files owned by your primary group
```
find ~/find_lab -type f -group $(id -gn)
```

**Use cases:**
- Audit files created by specific users
- Clean up files after removing users
- Check for unauthorized file ownership changes

## Part 7: Finding Files by Size

1. Create files of different sizes
```
cd ~/find_lab/data
dd if=/dev/zero of=small.bin bs=1K count=10    # 10KB
dd if=/dev/zero of=medium.bin bs=1M count=5    # 5MB
dd if=/dev/zero of=large.bin bs=1M count=50    # 50MB
ls -lh
```

2. Find files larger than 10MB
```
find ~/find_lab -type f -size +10M
```

3. Find files larger than 1MB
```
find ~/find_lab -type f -size +1M
```

4. Find files smaller than 1KB
```
find ~/find_lab -type f -size -1k
```

5. Find files between 1MB and 10MB
```
find ~/find_lab -type f -size +1M -size -10M
```

6. Find empty files
```
touch ~/find_lab/empty.txt
find ~/find_lab -type f -empty -delete # you can remove -delete 
```

## Part 8: Finding Recently Modified Files

Finding recently modified files is essential for troubleshooting, auditing changes, and monitoring system activity.

1. Create files with different timestamps
```
cd ~/find_lab
touch old_file.txt
sleep 2
touch newer_file.txt
echo "recently modified" > recent.txt
```

2. Find files modified in the last 24 hours (last day)
```
find ~/find_lab -type f -mtime -1
```

3. Find files modified in the last hour
```
find ~/find_lab -type f -mmin -60
```

4. Find files modified more than 7 days ago
```
find ~/find_lab -type f -mtime +7
```

5. Find files accessed in the last 24 hours
```
find ~/find_lab -type f -atime -1
```

6. Find files whose status changed in the last day
```
find ~/find_lab -type f -ctime -1
```

**Time-based search options:**
- `-mtime` - Modification time (content changed) in days
- `-mmin` - Modification time in minutes
- `-atime` - Access time (file read) in days
- `-amin` - Access time in minutes
- `-ctime` - Change time (metadata changed) in days
- `-cmin` - Change time in minutes

**Note:** Use `-` for "less than" (recent) and `+` for "greater than" (older).

## Part 9: Executing Commands with -exec

The `-exec` option allows you to perform actions on files found by `find`. This is extremely powerful for batch operations.

1. Find all .log files and display their sizes
```
cd ~/find_lab
find . -name "*.log" -exec ls -lh {} \;
```

2. Find all .txt files and display their content
```
find . -name "*.txt" -type f -exec cat {} \;
```

3. **Security Fix: Find all 777 files and change to 644**
```
cd ~/find_lab
# First, verify which files have 777 permissions
find . -type f -perm 777 -ls

# Now change them to 644
find . -type f -perm 777 -exec chmod 644 {} \;

# Verify the change
find . -type f -perm 644 -ls
```

**-exec syntax:**
- `{}` - Placeholder for the found file
- `\;` - End of the -exec command (semicolon must be escaped)
- `-exec command {} \;` - Runs command once for each file
- `-exec command {} +` - Runs command once with all files as arguments (more efficient, does not work with all commands)

**Safety tip:** Always test with `-ls` or `ls` before using destructive commands like `rm` or `chmod`.


## Cleanup
```
cd ~
rm -rf ~/find_lab
```

## Conclusion

In this lab, you mastered the `find` command, an essential tool for Linux system administration:

- **Basic searches**: Finding files by name, type, and using pattern matching
- **Error handling**: Using `2>/dev/null` to suppress permission errors when searching system-wide
- **Permission searches**: Finding files by permissions, including setuid/setgid binaries
- **Ownership searches**: Locating files by user and group ownership
- **Size-based searches**: Finding files by size for disk space management
- **Time-based searches**: Locating recently modified, accessed, or changed files
- **Action execution**: Using `-exec` to perform operations on found files, including security fixes
- **Real-world scenarios**: Applying find for security audits, disk management, and system maintenance

The `find` command is particularly powerful because it searches based on file metadata and attributes—not just names or content. Combined with `-exec`, it becomes a complete file management automation tool. Whether you're hardening security by finding world-writable files, managing disk space by locating large files, or troubleshooting issues by finding recent changes, `find` is indispensable.

These skills build on your knowledge of file permissions from the users and groups lab (3.2) and prepare you for more advanced scripting and automation tasks. As you continue your system administration journey, you'll find yourself using this command daily for maintenance, security, and troubleshooting tasks.
