# Package Management

Package management is one of the most fundamental skills for Linux system administrators. Rather than manually downloading, compiling, and installing software, package managers automate the process, handling dependencies, updates, and removal cleanly and consistently.

Amazon Linux 2023 uses DNF (Dandified YUM) as its package manager, which works with RPM (Red Hat Package Manager) files and is also used by Fedora, RHEL 8+, and other modern Red Hat-based distributions. Other Linux distributions use different package managers: Debian and Ubuntu use APT with .deb packages, while Arch Linux uses Pacman, and Alpine uses APK. The concepts are similar across all package managers—only the commands and package formats differ.

Understanding package management enables you to quickly deploy software, maintain system security through updates, and troubleshoot dependency issues. While package managers are the preferred method, you'll also encounter situations where binaries are downloaded directly and added to your $PATH, or where you need to install individual RPM files—patterns we'll explore in this lab.

### Estimated Time: 30 Minutes

## Part 1: Basic Package Operations

1. Create a working directory for this lab
```
mkdir -p ~/package_lab && cd ~/package_lab
```

2. Search for available packages
```
# Search for packages related to git
dnf search git

# Get detailed information about a specific package
dnf info git

# Search for packages that provide a specific file or command
dnf provides */bin/git
```

3. Install a package
```
# Install tree (a directory visualization tool)
sudo dnf install -y tree

# Verify installation
which tree
tree --version
```

4. Test the installed package
```
# Use tree to visualize your home directory structure
tree -L 2 ~
```

5. List installed packages
```
# Show all installed packages
dnf list installed | head -20

# Search for specific installed packages
dnf list installed | grep tree

# Show packages matching a pattern
dnf list installed "kernel*"
```

## Part 2: Package Versions and Updates

1. Check available versions of a package
```
# List available versions
dnf list available tree

# Show all versions (installed and available)
dnf list tree --showduplicates
```

2. Check for system updates
```
# List available updates
dnf check-update

# Show information about security updates
dnf updateinfo list security
```

3. Update a specific package
```
# Update tree to the latest version (if available)
sudo dnf update -y tree

# Check the updated version
dnf info tree
```

4. Update all packages on the system
```
# Update all packages (be careful in production!)
sudo dnf update -y

# Alternative: upgrade (removes obsolete packages)
sudo dnf upgrade -y
```

**Understanding update vs upgrade:**
- `update` - Updates packages to newer versions
- `upgrade` - Same as update, but also removes obsolete packages

## Part 3: Downgrading and Removing Packages

1. View package history
```
# Show recent DNF transactions
dnf history

# View details of a specific transaction
dnf history info 1
```

2. Downgrade a package (if a previous version exists)
```
# Downgrade to a previous version
sudo dnf downgrade tree

# Verify the version
dnf info tree
```

3. Remove a package
```
# Remove tree
sudo dnf remove -y tree

# Verify removal
which tree
dnf list installed | grep tree
```

4. Clean up package cache
```
# Remove cached packages and metadata
sudo dnf clean all
```

## Part 4: Direct Binary Installation (Brief Review)

Sometimes packages aren't available in repositories, so administrators download binaries directly and add them to $PATH.

1. Example pattern (review only, don't execute):
```
# Download binary
wget https://example.com/tool

# Make executable
chmod +x tool

# Move to PATH location
sudo mv tool /usr/local/bin/

# Now accessible system-wide
tool --version
```

This method works but lacks automatic updates and dependency management—use package managers when possible.

### Installing from RPM Files

You may also encounter standalone .rpm files that need to be installed directly.

```
# Download an RPM file (example only)
wget https://example.com/package.rpm

# Install the RPM file directly
sudo dnf install -y ./package.rpm

# Or use rpm command (doesn't handle dependencies automatically)
sudo rpm -ivh package.rpm

# Query installed RPM
rpm -q package
```

**Note:** Using `dnf install ./package.rpm` is preferred over `rpm -i` because DNF will automatically resolve and install dependencies from configured repositories.

## Part 5: Managing Repositories

Repositories are collections of packages hosted on remote servers. Amazon Linux 2023 comes with default repositories, but you can add third-party repos for additional software.

1. List current repositories
```
# Show enabled repositories
dnf repolist

# Show all repositories (enabled and disabled)
dnf repolist all
```

2. View repository configuration
```
# Repository configs are stored in /etc/yum.repos.d/
ls -l /etc/yum.repos.d/

# Examine a repository configuration
cat /etc/yum.repos.d/amazonlinux.repo
```

## Part 6: Adding External Repositories (Terraform Example)

Let's add HashiCorp's repository to install Terraform.

1. Add the HashiCorp repository
```
# Install yum-config-manager if not available
sudo dnf install -y dnf-plugins-core

# Add HashiCorp repository
sudo dnf config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
```

2. Verify the repository was added
```
# List repositories again
dnf repolist

# Check the repository file
cat /etc/yum.repos.d/hashicorp.repo
```

3. Search for packages in the new repository
```
# Search for Terraform
dnf search terraform

# Get detailed information
dnf info terraform
```

4. Install a package from the new repository
```
# First, list all available versions of Terraform
dnf list available terraform --showduplicates

# Install the latest version
sudo dnf install -y terraform

# Verify installation
terraform --version
which terraform
```

5. Install or downgrade to a specific version
```
# To install a specific version directly (example):
# sudo dnf install -y terraform-1.5.7

# Or downgrade from current version to a specific older version
# First, see what versions are available
dnf list available terraform --showduplicates

# Downgrade to a specific version (adjust version number based on available versions)
sudo dnf downgrade -y terraform-1.5.7

# Verify the downgraded version
terraform --version
```

**Note:** You can install a specific version using the format `package-version`. Use `dnf list available package --showduplicates` to see all available versions in the repository.


6. Remove the package
```
# Uninstall Terraform
sudo dnf remove -y terraform

# Verify removal
which terraform
```

7. Remove the repository
```
# Remove the repository configuration
sudo rm /etc/yum.repos.d/hashicorp.repo

# Verify removal
dnf repolist
ls /etc/yum.repos.d/
```

## Part 7: System Maintenance

Understanding when to reboot after updates is crucial for system administration.

1. Check if a reboot is required
```
# Check if any services need restart
sudo dnf needs-restarting

# Check if a full reboot is needed
sudo dnf needs-restarting -r
```

2. Reboot the system (only if needed and safe to do so)
```
# Reboot now
sudo reboot

# Schedule a reboot
sudo shutdown -r +5 "System will reboot in 5 minutes for updates"

# Cancel a scheduled reboot
sudo shutdown -c
```

**Important:** In production environments, coordinate reboots during maintenance windows and ensure proper backups exist.

## Cleanup
```
cd ~
rm -rf ~/package_lab
```

## Conclusion

In this lab, you mastered package management on Amazon Linux 2023 using DNF:

- **Basic operations**: Searching, installing, and removing packages with `dnf search`, `dnf install`, and `dnf remove`
- **Package information**: Viewing package details, available versions, and installed packages
- **Updates and upgrades**: Keeping your system secure with `dnf update` and `dnf upgrade`
- **Version management**: Downgrading packages and reviewing transaction history
- **Direct installation**: Understanding when to use wget and $PATH for binaries not in repositories
- **Repository management**: Listing, adding, and removing package repositories
- **Third-party repos**: Adding HashiCorp's repository to install Terraform
- **System maintenance**: Checking for required restarts and rebooting safely

Package management is the foundation of system administration. Properly managed packages ensure your systems remain secure, up-to-date, and consistent across your infrastructure. DNF's dependency resolution, rollback capabilities, and repository system make it a powerful tool for maintaining production Linux servers.

These skills prepare you for advanced topics like configuration management (Ansible, Puppet), containerization (Docker), and infrastructure as code—all of which build upon solid package management fundamentals.
