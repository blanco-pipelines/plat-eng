# Linux – Users, Groups, and Permissions

User and group management is fundamental to Linux system security and administration. The Linux permission model controls who can read, write, or execute files and directories, ensuring that users can only access resources they're authorized to use.

Every file and directory in Linux has an owner, a group, and a set of permissions that determine access rights. Understanding how to create users, manage group memberships, and configure permissions is essential for maintaining secure, multi-user systems.

Mastering these concepts allows you to implement principle of least privilege, control access to sensitive data, and troubleshoot permission-related issues—core responsibilities of every system administrator.

### Estimated Time: 35 Minutes

## Part 1: Understanding Current User and Groups

1. Check your current user and groups
```
whoami
```

2. See detailed information about your user
```
id
```

3. List all groups on the system
```
cat /etc/group | tail -n 20
```

4. See which groups you belong to
```
groups
```

**Understanding the output:**
- `uid` - User ID (unique number identifying the user)
- `gid` - Primary group ID
- `groups` - All groups the user belongs to

## Part 2: Creating a New User

1. Create a practice directory for this lab
```
mkdir -p ~/permissions_lab && cd ~/permissions_lab
```

2. Create a new user (you'll need sudo privileges)
```
sudo useradd -m -s /bin/bash alice
```

**Flags explained:**
- `-m` - Create home directory
- `-s /bin/bash` - Set default shell to bash

3. Set a password for the new user
```
sudo passwd alice
# Enter: alice123
```

4. Verify the user was created
```
id alice
cat /etc/passwd | grep alice
```

5. Check which groups alice belongs to
```
groups alice
```

Notice that alice has a primary group created automatically with the same name.

## Part 3: Creating and Managing Groups

1. Create some custom groups
```
sudo groupadd developers
sudo groupadd testers
sudo groupadd managers
```

2. Verify the groups were created
```
cat /etc/group | grep -E 'developers|testers|managers'
```

3. Add alice to the developers group
```
sudo usermod -aG developers alice
```

**Flags explained:**
- `-a` - Append (don't remove from other groups)
- `-G` - Supplementary groups

4. Add alice to multiple groups at once
```
sudo usermod -aG testers,managers alice
```

5. Verify alice's group memberships
```
groups alice
```

6. Create another user and add to a group in one command
```
sudo useradd -m -s /bin/bash bob -G developers
sudo passwd bob
# Enter: bob123
```

## Part 4: Refreshing Group Membership

When you add a user to a group, they need to log out and log back in (or start a new shell session) for the changes to take effect.

1. Switch to alice's account
```
sudo su - alice
```

2. Check current groups
```
groups
```

3. You should see all the groups. If you had added groups while already logged in as alice, you'd need to refresh. You can start a new login shell:
```
exec su - alice
# Or simply: exec bash -l
```

**Alternative method without full re-login:**
```
newgrp developers
# This starts a new shell with the specified group as primary
```

4. For now, exit back to your original user
```
exit
```

## Part 5: Understanding File Permissions

1. Create some test files
```
cd ~/permissions_lab
touch file1.txt
echo "Important data" > file2.txt
```

2. View detailed permissions
```
ls -l
```

3. Understand the permission format:
```
-rw-r--r--  1 user group  size date file.txt
│││││││││
│││││││││
│││├─┴─┴─── Others permissions (r--)
││├─┴─┴──── Group permissions (r--)
│├─┴─┴───── Owner permissions (rw-)
└────────── File type (- = regular file, d = directory)
```

**Permission breakdown:**
- `r` (read) = 4
- `w` (write) = 2
- `x` (execute) = 1
- `-` (no permission) = 0

## Part 6: Modifying Permissions with chmod

1. Create a script file
```
cat > script.sh << 'EOF'
#!/bin/bash
echo "Hello from script!"
EOF
```

2. Try to execute it (it will fail)
```
./script.sh
```

3. Add execute permission for owner
```
chmod u+x script.sh
ls -l script.sh
```

4. Now run it
```
./script.sh
```

5. Practice different chmod commands:
```
# Symbolic method
chmod u+w file1.txt    # Add write for user
chmod g+r file1.txt    # Add read for group
chmod o-r file1.txt    # Remove read for others
chmod a+r file1.txt    # Add read for all (user, group, others)

# Numeric method
chmod 755 script.sh    # rwxr-xr-x
chmod 644 file1.txt    # rw-r--r--
chmod 600 file2.txt    # rw-------
```

6. View the results
```
ls -l
```

## Part 7: Changing File Ownership

1. Create a file and check its ownership
```
touch myfile.txt
ls -l myfile.txt
```

2. Change ownership to alice
```
sudo chown alice myfile.txt
ls -l myfile.txt
```

3. Change group ownership
```
sudo chgrp developers myfile.txt
ls -l myfile.txt
```

4. Change owner and group in one command
```
touch another_file.txt
sudo chown alice:testers another_file.txt
ls -l another_file.txt
```

## Part 8: Practical Permission Scenarios

### Scenario 1: Shared Project Directory

1. Create a shared directory for the developers group
```
sudo mkdir /tmp/dev_project
sudo chgrp developers /tmp/dev_project
sudo chmod 770 /tmp/dev_project
ls -ld /tmp/dev_project
```

2. Switch to alice and test access
```
sudo su - alice
cd /tmp/dev_project
echo "Alice's work" > alice_notes.txt
ls -l
exit
```

3. Switch to bob and test access
```
sudo su - bob
cd /tmp/dev_project
ls -l
cat alice_notes.txt
echo "Bob's work" > bob_notes.txt
exit
```

4. Try accessing as your original user (not in developers group)
```
cd /tmp/dev_project
# This should fail with "Permission denied"
```

### Scenario 2: Read-Only Configuration Files

1. Create a configuration file as alice
```
sudo su - alice
cd ~
echo "database_host=localhost" > config.conf
echo "database_port=5432" >> config.conf
chmod 644 config.conf
ls -l config.conf
```

2. Try to modify it as bob
```
su bob
# Enter password: bob123
cat ~alice/config.conf
echo "modified" >> ~alice/config.conf
# This should fail
exit
```

3. Return to your original user
```
exit
```

### Scenario 3: Private Files

1. As alice, create a private file
```
sudo su - alice
echo "My secret password: super_secret" > private.txt
chmod 600 private.txt
ls -l private.txt
exit
```

2. Try to read it as bob
```
sudo su - bob
cat ~alice/private.txt
# Permission denied!
exit
```

3. Try to read it as your original user
```
cat ~alice/private.txt
# Permission denied!
```

4. Access it with sudo (administrative override)
```
sudo cat ~alice/private.txt
# This works because sudo gives you root privileges
```

## Part 9: Understanding sudo and su

1. Check sudo privileges
```
sudo -l
```

2. The difference between `su` and `su -`:
```
# su alice          # Switches user but keeps current environment
# su - alice        # Full login shell with alice's environment
```

3. Run a single command as another user
```
sudo -u alice whoami
sudo -u alice pwd
sudo -u alice touch /tmp/alice_temp_file
ls -l /tmp/alice_temp_file
```

## Part 10: Special Permissions - Setuid and Setgid

**Special permission bits:**
- `setuid (4)` - File executes with owner's permissions
- `setgid (2)` - File executes with group's permissions; new files inherit directory's group
- `sticky bit (1)` - Only owner can delete their files in directory (used on /tmp)

0644 → -rw-r--r-- (normal file)  
4644 → -rwSr--r-- (setuid set, runs with owner’s privileges)  
Setuid/setgid let programs run with owner or group permissions, which can be dangerous if the owner/group is root because it allows privilege escalation.

1. Check /tmp directory permissions
```
ls -ld /tmp
```

Notice the `t` at the end - this is the sticky bit.


## Cleanup

1. Remove test users (be careful with this command!)
```
sudo userdel -r alice
sudo userdel -r bob
```

2. Remove test groups
```
sudo groupdel developers
sudo groupdel testers  
sudo groupdel managers
```

3. Clean up directories
```
cd ~
rm -rf ~/permissions_lab
sudo rm -rf /tmp/dev_project 
```

## Conclusion

In this lab, you mastered Linux user, group, and permission management:

- **User management**: Creating users with useradd, setting passwords, and understanding user attributes
- **Group management**: Creating groups, adding users to groups, and managing group memberships
- **File permissions**: Reading and modifying permissions with chmod using both symbolic and numeric notation
- **Ownership**: Changing file owners and groups with chown and chgrp
- **Access control**: Demonstrating how permissions control file and directory access
- **User switching**: Using su and sudo to work as different users and execute privileged commands
- **Group refresh**: Using su, exec, and newgrp to refresh group memberships without full logout

The Linux permission system implements security through the principle of least privilege—users should only have the minimum access needed to perform their tasks. Understanding how to properly configure users, groups, and permissions is essential for maintaining secure, multi-user Linux systems.

These skills form the foundation for more advanced topics like Access Control Lists (ACLs), SELinux, and system hardening that you'll encounter as you grow in your system administration career.
