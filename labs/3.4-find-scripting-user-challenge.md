# Lab 3.4 – System Administration Automation Challenge

This challenge integrates shell scripting, user and permission management, and file system operations. You'll automate common system administration tasks using the skills from labs 3.1-3.3.

Complete each task using only the command line. Think critically about combining scripting, permissions, and file finding to build robust automation solutions.

## Part 1: Team Environment Setup Script

Create a script named `setup_team.sh` that:
- Uses proper shebang and error handling (set -e, set -u)
- Creates three users: alice, bob, charlie with passwords
- Creates three groups: developers, testers, auditors
- Adds alice to developers and auditors
- Adds bob to developers and testers
- Adds charlie to testers and auditors
- Prints a summary of each user's group memberships

Make the script executable, test it, and verify all users and groups were created correctly.

## Part 2: Project Directory Builder

Create a script named `create_project.sh` that:
- Takes a project name as an argument (exit with error if missing)
- Creates a directory structure in /tmp/{project_name}/ with subdirectories: src, config, logs, data, scripts
- Sets permissions appropriately:
  - src and data: 770 (developers only)
  - config: 754 (readable by all, writable by developers)
  - logs: 774 (writable by developers and testers)
  - scripts: 755 (readable and executable by all)
- Changes group ownership to developers
- Creates a README.txt with project name, creation date, and creator

Test by creating a project called "webapp" and verify permissions with `ls -l`.

## Part 3: Security Audit Script

Create `security_audit.sh` that:
- Takes a directory path as argument (defaults to /tmp)
- Validates the directory exists
- Finds and counts:
  - Files with 777 permissions
  - World-writable files
  - Files larger than 10MB
  - Files modified in last 24 hours
  - Any setuid or setgid files
- Saves report to `security_report_<timestamp>.txt`
- Prints summary counts to screen

Run it on /tmp and on your webapp project directory.

## Part 4: File Organization Script

Create `organize_files.sh` that:
- Takes a directory path as argument
- Creates subdirectories: logs/, configs/, scripts/, data/, others/
- Moves files by extension using find and -exec:
  - *.log → logs/
  - *.conf, *.ini → configs/
  - *.sh, *.py → scripts/
  - *.txt, *.csv, *.json → data/
  - Everything else → others/
- Sets permissions: 755 for scripts, 644 for all other files
- Prints count of files moved to each directory

Create a test directory with 15+ mixed files and test your script.

## Part 5: Advanced Integration Challenge

Create a master script named `team_automation.sh` that:
- Accepts a team name as argument
- Creates users: {team}_dev1, {team}_dev2, {team}_tester
- Creates groups: {team}_developers, {team}_testers
- Assigns users to appropriate groups
- Creates a complete project directory for the team in /tmp
- Sets up proper permissions based on team roles
- Creates a README and a sample config file (640, owned by dev1)
- Runs a security audit on the new project
- Generates a setup report showing all created resources
- Uses functions to organize the code
- Includes comprehensive error handling

Test by creating an environment for team "platform" and verify everything is correct.

## Part 6: Cleanup

Create `cleanup_lab.sh` that:
- Prompts for confirmation before deleting
- Shows what will be deleted
- Removes all users created (alice, bob, charlie, team users)
- Removes all groups created
- Removes project directories in /tmp
- Removes all report and log files
- Continues even if some items don't exist (error handling)

## Success Criteria

You have successfully completed this challenge when you can:
- Write shell scripts with proper error handling and structure
- Automate user, group, and permission management
- Use find effectively with multiple criteria and -exec
- Integrate scripting, permissions, and file operations cohesively
- Handle arguments, validation, and provide helpful error messages

## Reflection Questions

- How does error handling make your scripts more robust?
- When should you use numeric vs. symbolic permissions?
- Why validate user input before performing operations?
- What security considerations matter when creating users and setting permissions?
- How would you modify these scripts for production use?

## Tips

- Use `set -e` and `set -u` for robust error handling
- Test find commands without -exec first
- Use `2>/dev/null` when searching system directories
- Group changes require logout/login or `newgrp` to take effect
- Comment your code to explain why, not just what
- Use functions to organize complex scripts

Remember: Build practical tools that real system administrators would use. Think about edge cases and user experience.
